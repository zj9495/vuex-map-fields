import{cloneDeep}from"lodash";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(t.push(i.value),!r||t.length!==r);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(a)throw o}}return t}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function arrayToObject(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,r){var t=r.split(".").slice(-1)[0];if(e[t])throw new Error("The key `".concat(t,"` is already in use."));return e[t]=r,e},{})}var DeepProxy=function(){function e(r,t){return _classCallCheck(this,e),this._preproxy=new WeakMap,this._handler=t,this.proxify(r,[])}return _createClass(e,[{key:"makeHandler",value:function(e){var r=this;return{set:function(t,n,a,o){return"object"==typeof a&&(a=r.proxify(a,[].concat(_toConsumableArray(e),[n]))),t[n]=a,r._handler.set&&r._handler.set(t,[].concat(_toConsumableArray(e),[n]),a,o),!0},deleteProperty:function(t,n){if(Reflect.has(t,n)){r.unproxy(t,n);var a=Reflect.deleteProperty(t,n);return a&&r._handler.deleteProperty&&r._handler.deleteProperty(t,[].concat(_toConsumableArray(e),[n])),a}return!1}}}},{key:"unproxy",value:function(e,r){this._preproxy.has(e[r])&&(e[r]=this._preproxy.get(e[r]),this._preproxy.delete(e[r]));for(var t=0,n=Object.keys(e[r]);t<n.length;t++){var a=n[t];"object"==typeof e[r][a]&&this.unproxy(e[r],a)}}},{key:"proxify",value:function(e,r){for(var t=0,n=Object.keys(e);t<n.length;t++){var a=n[t];"object"==typeof e[a]&&(e[a]=this.proxify(e[a],[].concat(_toConsumableArray(r),[a])))}var o=new Proxy(e,this.makeHandler(r));return this._preproxy.set(o,e),o}}]),e}();function objectEntries(e){return Object.keys(e).map(function(r){return[r,e[r]]})}function normalizeNamespace(e){return function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];var a=_slicedToArray("string"==typeof t[0]?[].concat(t):[""].concat(t),4),o=a[0],i=a[1],c=a[2],u=a[3];return o.length&&"/"!==o.charAt(o.length-1)&&(o+="/"),c="".concat(o).concat(c||"getField"),u="".concat(o).concat(u||"updateField"),e(o,i,c,u)}}function getField(e){return function(r){return""==r?e:r.split(/[.[\]]+/).reduce(function(e,r){return e[r]},e)}}function updateField(e,r){var t=r.path,n=r.value;t.split(/[.[\]]+/).reduce(function(e,r,t,a){return a.length===t+1&&(e[r]=n),e[r]},e)}var mapFields=normalizeNamespace(function(e,r,t,n){var a=Array.isArray(r)?arrayToObject(r):r;return Object.keys(a).reduce(function(e,r){var o=a[r],i={get:function(){return this.$store.getters[t](o)},set:function(e){this.$store.commit(n,{path:o,value:e})}};return e[r]=i,e},{})}),mapMultiRowFields=normalizeNamespace(function(e,r,t,n){var a=Array.isArray(r)?arrayToObject(r):r;return Object.keys(a).reduce(function(e,r){var o=a[r];return e[r]={get:function(){var e=this.$store;return objectEntries(e.getters[t](o)).map(function(r){return Object.keys(r[1]).reduce(function(a,i){var c="".concat(o,"[").concat(r[0],"].").concat(i);return Object.defineProperty(a,i,{get:function(){return e.getters[t](c)},set:function(r){e.commit(n,{path:c,value:r})}})},{})})}},e},{})}),mapObjectFields=normalizeNamespace(function(e,r,t,n){var a=Array.isArray(r)?arrayToObject(r):r;return Object.keys(a).reduce(function(e,r){var o=a[r].replace(/\.?\*/g,"");return e[r]={get:function(){var e=this.$store,r=cloneDeep(e.getters[t](o));return r?new DeepProxy(r,{set:function(r,t,a){var i=o?"".concat(o,".").concat(t.join(".")):t;e.commit(n,{path:i,value:a})}}):{}}},e},{})}),createHelpers=function(e){var r,t=e.getterType,n=e.mutationType;return _defineProperty(r={},t,getField),_defineProperty(r,n,updateField),_defineProperty(r,"mapFields",normalizeNamespace(function(e,r){return mapFields(e,r,t,n)})),_defineProperty(r,"mapMultiRowFields",normalizeNamespace(function(e,r){return mapMultiRowFields(e,r,t,n)})),_defineProperty(r,"mapObjectFields",normalizeNamespace(function(e,r){return mapObjectFields(e,r,t,n)})),r};export{createHelpers,getField,mapFields,mapMultiRowFields,mapObjectFields,updateField};